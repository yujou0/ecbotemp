import{u as N,a as V,_ as $,b as F,c as O}from"./globalFunctions.6c536278.js";import{l as z,a as B,r as n,b as J,o as j,c as i,d,e,f as p,w as E,F as G,g as q,h as H,t as g,i as x,v as T,u as Y}from"./index.acd8174a.js";const K={class:"userAcount position-relative"},Q={class:"searchResult"},W=e("h4",{class:"mt-0"},"\u5E33\u865F\u7BA1\u7406",-1),X={class:"searchResult-content"},Z={class:"Result"},ee={class:"table table-hover m-0"},te=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"\u5E33\u865F"),e("th",null,"\u67E5\u8A62"),e("th",null,"\u7BA1\u7406"),e("th",null,"\u4FEE\u6539\u4EBA\u54E1"),e("th",null,"\u4E0A\u6B21\u4FEE\u6539\u6642\u9593")])],-1),ae={key:0},oe=["onUpdate:modelValue","checked","disabled"],se=["onUpdate:modelValue","checked","disabled"],le={style:{width:"150px"}},ne={style:{width:"150px"}},ue={class:"d-flex justify-content-end"},ce={key:0},re={key:1,style:{width:"20px",height:"20px"},class:"spinner-border text-light",role:"status"},ie=e("span",{class:"sr-only"},null,-1),de=[ie],I=20,pe={__name:"userAcount",setup(he){const L=z(),b=N(),A=V(),R=B.get("ECBO_role"),h=n(1),w=n(0),f=n(0),r=n([]),a=n([]),v=n(!1),o=J(),C=n(!1),D=n(R),k=n("/System/AccountRole");j(()=>{a.value.length==0&&(o.IsLoading=!0,m()),typeof R>"u"&&L.userLogout()});const U=t=>D.value.includes("SuperAdmin")||D.value.includes("Admin")&&t==="Read",P=(t,s)=>t.filter(l=>{const _=s.find(S=>S.Account===l.Account);return _&&JSON.stringify(l.Role)!==JSON.stringify(_.Role)}),m=async t=>{try{typeof t!="number"?t=h.value:h.value=t;const s=`${k.value}?page=${t}&pagesize=20`,l=await b.getData(s);l.State===0?(r.value=l.Data.Data,w.value=l.Data.PageCount,f.value=l.Data.TotalCount,a.value=JSON.parse(JSON.stringify(r.value))):(r.value=[],a.value=[]),C.value=!0,o.IsLoading=!1}catch(s){console.error(s),o.IsLoading=!1}},M=async()=>{v.value=!0;try{const t=P(a.value,r.value);if(t.length==0){v.value=!1;return}const s=await b.putData(t,k.value);s.State===0?(C.value=!0,v.value=!1,o.IsLoading=!1,o.ShowAlertText="\u5DF2\u5132\u5B58",o.ShowAlertIcon="bi-check-circle",o.ShowAlert=!0,m(),setTimeout(()=>{o.ShowAlert=!1},1e3)):(v.value=!1,o.IsLoading=!1,o.ShowAlertText="\u4FEE\u6539\u5931\u6557"+s.Msg,o.ShowAlertIcon="bi bi-x-circle",o.ShowAlert=!0,setTimeout(()=>{o.ShowAlert=!1},1e3))}catch(t){console.error(t)}};return(t,s)=>{const l=$,_=F,S=O;return i(),d("div",K,[e("div",Q,[W,e("div",X,[e("div",Z,[p(l,{class:"mt-0",currentPage:h.value,pageSize:I,searchedData:r.value,totalCount:f.value},null,8,["currentPage","searchedData","totalCount"]),p(_,null,{default:E(()=>[e("table",ee,[te,a.value.length>0?(i(),d("tbody",ae,[(i(!0),d(G,null,q(a.value,(c,u)=>(i(),d("tr",{key:c.Id,class:""},[e("td",null,g(u+1),1),e("td",null,g(c.Account+"@55688.com.tw"),1),e("td",null,[x(e("input",{type:"checkbox",value:"Read","onUpdate:modelValue":y=>a.value[u].Role=y,checked:a.value[u].Role.includes("Read"),disabled:!U("Read")},null,8,oe),[[T,a.value[u].Role]])]),e("td",null,[x(e("input",{type:"checkbox",value:"Admin","onUpdate:modelValue":y=>a.value[u].Role=y,checked:a.value[u].Role.includes("SuperAdmin")||a.value[u].Role.includes("Admin"),disabled:!U("Admin")},null,8,se),[[T,a.value[u].Role]])]),e("td",le,g(c.Updator?c.Updator:"--"),1),e("td",ne,g(Y(A).formatDateToYYYYMMDD(c.UpdateTime)?Y(A).formatDateToYYYYMMDD(c.UpdateTime):"--"),1)]))),128))])):H("",!0)])]),_:1}),p(l,{currentPage:h.value,pageSize:I,searchedData:r.value,totalCount:f.value},null,8,["currentPage","searchedData","totalCount"]),e("div",ue,[e("button",{type:"submit",onClick:s[0]||(s[0]=c=>M()),class:"btn btn-primary mediumbtn d-flex justify-content-center align-items-center"},[v.value?(i(),d("div",re,de)):(i(),d("span",ce," \u5132\u5B58"))])]),e("div",null,[p(S,{searchFun:m,currentPage:h.value,pageCount:w.value},null,8,["currentPage","pageCount"])])])])])])}}};export{pe as default};
